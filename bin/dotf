#!/usr/bin/env ruby

require_relative "../lib/dot_files"

path = File.expand_path("~/.dotf")

description = "Usage: dotf command [arguments]
  init            initializes dotf
  tags [tags ...] prints the current tags [adds new tags if given]
  key  [key]      prints the current key [changes key if given]
  status          displays whether dotfiles are currently linked or not
  run             compiles and links dotfiles"

case command = ARGV.first
when "init" then DotFiles.new(path).init
when "tags"
  if ARGV.length > 1
    _, *tags = *ARGV
    DotFiles.new(path).write_tags(tags)
  end

  DotFiles.new(path).tags.to_a.sort.each { |tag| puts tag }
when "key"
  if ARGV.length > 1
    key = ARGV[1]
    DotFiles.new(path).write_key(key)
  end

  puts DotFiles.new(path).key
when "status"
  DotFiles.new(path).status.each { |status| puts status }
when "compile" then DotFiles.new(path).compile
when "link" then DotFiles.new(path).link
when "run"
  DotFiles.new(path).compile
  DotFiles.new(path).link
when nil
  puts description
else
  puts "Unrecognized command: #{command}"
  puts description
end
